CREATE DATABASE app03_carbajal_clase;

SELECT * FROM usuarios
CREATE TABLE usuarios (
    id_usuario SERIAL PRIMARY KEY,
    nombre1  VARCHAR(70)NOT NULL,
    nombre2  VARCHAR(70),
    apellido1 VARCHAR(70) NOT NULL,
    apellido2 VARCHAR(70),
    telefono BIGINT,
    dpi BIGINT,
    correo VARCHAR(100) NOT NULL UNIQUE,
    usuario_clave lVARCHAR(1056) NOT NULL,
    token lVARCHAR(1056),
    fecha_creacion DATETIME YEAR TO SECOND DEFAULT CURRENT YEAR TO SECOND,
    fecha_clave DATETIME YEAR TO SECOND DEFAULT CURRENT YEAR TO SECOND,
    fotografia lVARCHAR(2056),
    situacion SMALLINT  DEFAULT 1
);
-------------------------------
SELECT * FROM aplicacion
CREATE TABLE aplicacion (
    id_app SERIAL PRIMARY KEY,
    nombre_app_lg LVARCHAR(2056),
    nombre_app_md LVARCHAR(1056),
    nombre_app_ct LVARCHAR(255),
    fecha_creacion DATETIME YEAR TO SECOND DEFAULT CURRENT YEAR TO SECOND,
    situacion SMALLINT  DEFAULT 1
);

-----------------------------------
select *from permisos
CREATE TABLE permisos (
    id_permiso SERIAL PRIMARY KEY,
    nombre_permiso VARCHAR(70) NOT NULL,
    clave_permiso VARCHAR(70),
    descripcion VARCHAR(255),
    fecha_creacion DATETIME YEAR TO SECOND DEFAULT CURRENT YEAR TO SECOND,
    situacion SMALLINT  DEFAULT 1
);

SELECT * FROM permiso_aplicacion
CREATE TABLE permiso_aplicacion (
    id_permiso_app SERIAL PRIMARY KEY,
    id_permiso INT NOT NULL,
    id_app INT NOT NULL,
    fecha_creacion DATETIME YEAR TO SECOND DEFAULT CURRENT YEAR TO SECOND,
    situacion SMALLINT DEFAULT 1,
  
    FOREIGN KEY (id_permiso) REFERENCES permisos (id_permiso),
    FOREIGN KEY (id_app) REFERENCES aplicacion (id_app)
);

----------------------------------------------------------------------
select *from asig_permisos
DROP TABLE asig_permisos
CREATE TABLE asig_permisos (
    id_asig_permiso SERIAL PRIMARY KEY,
    id_usuario INT,
    id_permiso_app INT,
    fecha_creacion DATETIME YEAR TO SECOND DEFAULT CURRENT YEAR TO SECOND,
    fecha_expiro DATETIME YEAR TO SECOND,
    usuario_asigno INT,
    motivo LVARCHAR(255),
    situacion SMALLINT  DEFAULT 1
);

ALTER TABLE asig_permisos 
    ADD CONSTRAINT FOREIGN KEY (id_usuario) 
    REFERENCES usuarios CONSTRAINT fk_permisos_usuarios;
    
ALTER TABLE asig_permisos 
    ADD CONSTRAINT FOREIGN KEY (id_permiso_app) 
    REFERENCES permiso_aplicacion CONSTRAINT fk_permisos_asig;